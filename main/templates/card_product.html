{% load static %}
{% load humanize %}

<style>
.glass-card {
  background: linear-gradient(to bottom, white, #EEE9DA);
  border: 2px solid #BDCDD6;
  box-shadow: 0 2px 8px rgba(96, 150, 180, 0.15);
  transform-style: preserve-3d;
  transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
}

.glass-card:hover {
  transform: translateY(-15px) rotateX(5deg) rotateY(5deg);
  box-shadow: 0 25px 50px rgba(96, 150, 180, 0.3);
}

.card-shine {
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(189, 205, 214, 0.3), transparent);
  transform: rotate(45deg);
  transition: all 0.6s;
  pointer-events: none;
}

.glass-card:hover .card-shine {
  left: 100%;
}

.floating-badge {
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.magnetic-btn {
  transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
}

.magnetic-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 10px 25px rgba(96, 150, 180, 0.4);
}
</style>

<article class="glass-card rounded-2xl overflow-hidden relative h-full flex flex-col">
  <!-- Shine Effect -->
  <div class="card-shine"></div>
  
  <!-- Image Container -->
  <div class="relative aspect-square overflow-hidden group">
    <a href="{% url 'main:show_product' product.id %}" class="block w-full h-full">
      {% if product.thumbnail %}
        <img src="{{ product.thumbnail }}" 
             alt="{{ product.name }}" 
             class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-110">
      {% else %}
        <div class="w-full h-full flex items-center justify-center" style="background-color: #EEE9DA; color: #93BFCF;">
          <span class="text-4xl">📦</span>
        </div>
      {% endif %}
    </a>

    <!-- Floating Category Badge -->
    <div class="absolute top-4 left-4 z-20">
      <span class="floating-badge inline-flex items-center px-3 py-1 rounded-full text-xs font-bold text-white shadow-lg" style="background-color: #6096B4;">
        {% if product.category == 'shoes' %}👟{% elif product.category == 'clothes' %}👕{% elif product.category == 'equipment' %}⚽{% elif product.category == 'accessories' %}🎽{% else %}📦{% endif %}
        {{ product.get_category_display }}
      </span>
    </div>

    <!-- Status Badges -->
    <div class="absolute top-4 right-4 flex flex-col gap-2 z-20">
      {% if product.is_featured %}
        <span class="floating-badge inline-flex items-center px-3 py-1 rounded-full text-xs font-bold shadow-lg bg-yellow-100 text-yellow-800">
          ⭐ Featured
        </span>
      {% endif %}
      {% if product.is_hot %}
        <span class="floating-badge inline-flex items-center px-3 py-1 rounded-full text-xs font-bold shadow-lg bg-red-100 text-red-800" style="animation-delay: 0.5s;">
          🔥 Hot
        </span>
      {% endif %}
    </div>

    <!-- Hover Overlay -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-6 z-10 pointer-events-none">
      <span class="text-white font-bold text-lg transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
        View Details →
      </span>
    </div>
  </div>

  <!-- Content -->
  <div class="p-6 flex-grow flex flex-col">
    <!-- Date & Views -->
    <div class="flex items-center text-sm mb-3" style="color: #6096B4;">
      {% if product.created_at %}
        <time datetime="{{ product.created_at|date:'c' }}" class="flex items-center gap-1">
          <span>📅</span>
          {{ product.created_at|date:"M j, Y" }}
        </time>
      {% else %}
        <p class="flex items-center gap-1">
          <span>📅</span>
          Unknown date
        </p>
      {% endif %}
      <span class="mx-2">•</span>
      <span class="flex items-center gap-1">
        <span>👁️</span>
        {{ product.views }}
      </span>
    </div>

    <!-- Brand -->
    <h5 class="text-sm mb-1 font-medium" style="color: #6096B4;">
      🏷️ {{ product.brand }}
    </h5>

    <!-- Title -->
    <h3 class="text-lg font-bold text-gray-900 mb-3 leading-tight" style="height: 3.5rem; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
      <a href="{% url 'main:show_product' product.id %}" class="transition-colors hover:underline" onmouseover="this.style.color='#6096B4'" onmouseout="this.style.color='#111827'">
        {{ product.name }}
      </a>
    </h3>

    <!-- Rating -->
    <div class="flex items-center gap-2 mb-3">
      <div class="flex">
        {% for i in "12345" %}
          {% if forloop.counter <= product.rating %}
            <svg class="w-4 h-4 text-yellow-400 transform transition-transform hover:scale-125" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.974a1 1 0 00.95.69h4.18c.969 0 1.371 1.24.588 1.81l-3.39 2.462a1 1 0 00-.364 1.118l1.287 3.974c.3.921-.755 1.688-1.54 1.118l-3.39-2.462a1 1 0 00-1.175 0l-3.39 2.462c-.784.57-1.838-.197-1.539-1.118l1.286-3.974a1 1 0 00-.364-1.118L2.225 9.4c-.783-.57-.38-1.81.588-1.81h4.18a1 1 0 00.951-.69l1.285-3.974z"></path></svg>
          {% else %}
            <svg class="w-4 h-4 text-gray-300 transform transition-transform hover:scale-125" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.974a1 1 0 00.95.69h4.18c.969 0 1.371 1.24.588 1.81l-3.39 2.462a1 1 0 00-.364 1.118l1.287 3.974c.3.921-.755 1.688-1.54 1.118l-3.39-2.462a1 1 0 00-1.175 0l-3.39 2.462c-.784.57-1.838-.197-1.539-1.118l1.286-3.974a1 1 0 00-.364-1.118L2.225 9.4c-.783-.57-.38-1.81.588-1.81h4.18a1 1 0 00.951-.69l1.285-3.974z"></path></svg>
          {% endif %}
        {% endfor %}
      </div>
      <span class="text-sm text-gray-600">({{ product.rating }} / 5.0)</span>
    </div>

    <!-- Price -->
    <h4 class="text-xl font-bold mb-3 flex items-center gap-1 transition-all hover:scale-105" style="color: #22c55e;">
      <span>💵</span>
      Rp {{ product.price|intcomma }}
    </h4>

    <!-- Description -->
    <p class="text-gray-600 text-sm leading-relaxed mb-4 flex-grow" style="height: 4rem; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">
      {{ product.description }}
    </p>

    <!-- Action Buttons -->
    {% if user.is_authenticated and product.user == user %}
      <div class="flex gap-2 pt-4 mt-auto" style="border-top: 1px solid #BDCDD6;">
        <a href="{% url 'main:show_product' product.id %}" class="magnetic-btn flex-1 text-white text-sm font-bold px-4 py-3 rounded-xl text-center" style="background: linear-gradient(to right, #6096B4, #93BFCF);">
          👁️ Details
        </a>
        <a href="{% url 'main:edit_product' product.id %}" class="magnetic-btn flex-1 text-white text-sm font-bold px-4 py-3 rounded-xl text-center" style="background: linear-gradient(to right, #f59e0b, #fbbf24);">
          ✏️ Edit
        </a>
        <a href="{% url 'main:delete_product' product.id %}" class="magnetic-btn flex-1 text-white text-sm font-bold px-4 py-3 rounded-xl text-center" style="background: linear-gradient(to right, #ef4444, #f87171);">
          🗑️ Delete
        </a>
      </div>
    {% else %}
      <div class="flex gap-3 mt-auto">
        <a href="{% url 'main:show_product' product.id %}" class="magnetic-btn flex-1 text-white font-bold py-3 rounded-xl text-center" style="background: linear-gradient(to right, #6096B4, #93BFCF);">
          🔎 View Details
        </a>
      </div>
    {% endif %}
  </div>
</article>